<!DOCTYPE HTML>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Find a route using Geolocation and Google Maps API</title>
    <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>



<b>Calculate your route</b>
<form id="calculate-route" name="calculate-route" action="#" method="get">
  <label for="from">From:</label>
  <input type="text" id="from" name="from" required="required" placeholder="Enter your address or click for location" size="30" value="" />
  <a id="from-link" href="#">Click here for your location</a>
  <br />

  <label for="to">To:</label>
  <select id="to">
    <option value="50.861822, -0.083278">Brighton & Hove Albion's American Express Community Stadium</option>
    <option value="53.430833, -2.960833">Liverpool's Anfield</option>
    <option value="52.988333, -2.175556">Stoke City's bet365 Stadium</option>
    <option value="51.5548885,-0.108438">Arsenal's Emirates Stadium</option>
    <option value="53.438889, -2.966389">Everton's Goodison Park</option>
    <option value="53.438889, -2.966389">West Bromwich Albion's The Hawthorns</option>
    <option value="53.654167, -1.768333">Huddersfield Town's John Smiths Stadium</option>
    <option value="52.620278, -1.142222">Leicester City's King Power Stadium</option>
    <option value="51.538611, -0.016389">West Ham United's London Stadium</option>
    <option value="53.463056, -2.291389">Manchester United's Old Trafford</option>
    <option value="54.975556, -1.621667">Newcastle United’s St James’ Park</option>
    <option value="50.905833, -1.391111">Southampton's St Mary’s Stadium</option>
    <option value="51.398333, -0.085556">Crystal Palace's Selhurst Park</option>
    <option value="51.481663,-0.1931505">Chelsea's Stamford Bridge</option>
    <option value="53.789167, -2.230278">Burnley's Turf Moor</option>
    <option value="51.65, -0.401667">Watford's Vicarage Road</option>
    <option value="50.735278, -1.838333">Bournemouth's Vitality Stadium</option>
    <option value="51.555833, -0.279722">Tottenham Hostpur's Wembley Stadium</option>
    <option value="53.483056, -2.200278">Manchester City's Etihad Stadium</option>
    <option value="51.642778, -3.934722">Swansea City's Liberty Stadium</option>

  </select>

  <br />

  <input type="submit" />
  <input type="reset" />
</form>
<div id="map"></div>
<p id="error"></p>

<style>
html,
body {
  height: 100%;
  width: 100%;
  margin: 0px;
  padding: 0px;
  background-color: white;

  #right-panel {
       font-family: 'Roboto','sans-serif';
       line-height: 30px;
       padding-left: 10px;
     }

     #right-panel select, #right-panel input {
       font-size: 15px;
     }

     #right-panel select {
       width: 100%;
     }

     #right-panel i {
       font-size: 12px;
     }
     #right-panel {
       height: 100%;
       float: right;
       width: 390px;
       overflow: auto;
     }
}
#map {
  height: 80%;
  width: 100%;
    margin: 0px;
  padding: 0px;
}
</style>

<script>
var locations = [
  ['Brighton & Hove Albion’s American Express Community Stadium', 50.861822, -0.083278],
  ['Liverpool’s Anfield', 53.430833, -2.960833],
  ['Stoke City’s bet365 Stadium', 52.988333, -2.175556],
  ['Arsenal’s Emirates Stadium', 51.5548885,-0.108438],
  ['Everton’s Goodison Park', 53.438889, -2.966389],
  ['West Bromwich Albion’s The Hawthorns', 52.509167, -1.963889],
  ['Huddersfield Town’s John Smith’s Stadium', 53.654167, -1.768333],
  ['Leicester City’s King Power Stadium', 52.620278, -1.142222],
  ['West Ham United’s London Stadium', 51.538611, -0.016389],
  ['Manchester United’s Old Trafford', 53.463056, -2.291389],
  ['Newcastle United’s James Park', 54.975556, -1.621667],
  ['Southampton’s St Mary’s stadium' , 50.905833, -1.391111],
  ['Crystal Palace’s Selhurst Park', 51.398333, -0.085556],
  ['Chelsea’s Stamford Bridge', 51.481667, -0.191111],
  ['Burnley’s Turf Moor', 53.789167, -2.230278],
  ['Watford’s Vicarage Road', 51.65, -0.401667],
  ['Bournemouth’s Vitality Stadium', 50.735278, -1.838333],
  ['Tottenham Hotspurs’s Wembley Stadium', 51.555833, -0.279722],
  ['Manchester City’s Etihad Stadium', 53.483056, -2.200278],
  ['Swansea City’s Liberty Stadium', 51.642778, -3.934722]
    ];


    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 10,
      center: new google.maps.LatLng(53.483959, -2.244644),
      zoom: 6,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    var infowindow = new google.maps.InfoWindow();

    var marker, i;

    for (i = 0; i < locations.length; i++) {
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
        map: map
      });

      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(locations[i][0]);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }



function calculateRoute(from, to) {
  // Center initialized somewhere near London
  var myOptions = {
    zoom: 10,
    center: new google.maps.LatLng(53, -1),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  // Draw the map
  var mapObject = new google.maps.Map(document.getElementById("map"), myOptions);
  var markerArray = [];
  var stepDisplay;
  var directionsDisplay = new google.maps.DirectionsRenderer({map: map});
  var directionsService = new google.maps.DirectionsService();
  var directionsRequest = {
    origin: from,
    destination: to,
    travelMode: google.maps.DirectionsTravelMode.TRANSIT,
    unitSystem: google.maps.UnitSystem.METRIC
  };

  directionsService.route(
    directionsRequest,
    function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        new google.maps.DirectionsRenderer({
          map: mapObject,
          directions: response,
          suppressMarkers: true
        });
        console.log(response.routes.length);
        createMarker(response.routes[0].legs[0].start_location, "start", document.getElementById('from').value, "green", "A", mapObject);
        createMarker(response.routes[0].legs[0].end_location, "end", $("#to option:selected").text(), "red", "B", mapObject)
      } else
        $("#error").append("Unable to retrieve your route<br />");
    }
  );
}

function calculateAndDisplayRoute(directionsDisplay, directionsService,
    markerArray, stepDisplay, map) {
  // First, remove any existing markers from the map.
  for (var i = 0; i < markerArray.length; i++) {
    markerArray[i].setMap(null);
  }

  // Retrieve the start and end locations and create a DirectionsRequest using
  // WALKING directions.
  directionsService.route({
    origin: from
    destination: document.getElementById('end').value,
    travelMode: 'WALKING'
  }, function(response, status) {
    // Route the directions and pass the response to a function to create
    // markers for each step.
    if (status === 'OK') {
      document.getElementById('warnings-panel').innerHTML =
          '<b>' + response.routes[0].warnings + '</b>';
      directionsDisplay.setDirections(response);
      showSteps(response, markerArray, stepDisplay, map);
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  });
}

function showSteps(directionResult, markerArray, stepDisplay, map) {
  // For each step, place a marker, and add the text to the marker's infowindow.
  // Also attach the marker to an array so we can keep track of it and remove it
  // when calculating new routes.
  var myRoute = directionResult.routes[0].legs[0];
  for (var i = 0; i < myRoute.steps.length; i++) {
    var marker = markerArray[i] = markerArray[i] || new google.maps.Marker;
    marker.setMap(map);
    marker.setPosition(myRoute.steps[i].start_location);
    attachInstructionText(
        stepDisplay, marker, myRoute.steps[i].instructions, map);
  }
}

function attachInstructionText(stepDisplay, marker, text, map) {
  google.maps.event.addListener(marker, 'click', function() {
    // Open an info window when the marker is clicked on, containing the text
    // of the step.
    stepDisplay.setContent(text);
    stepDisplay.open(map, marker);
  });
}


$(document).ready(function() {
  // If the browser supports the Geolocation API
  if (typeof navigator.geolocation == "undefined") {
    $("#error").text("Your browser doesn't support the Geolocation API");
    return;
  }

  $("#from-link, #to-link").click(function(event) {
    event.preventDefault();
    var addressId = this.id.substring(0, this.id.indexOf("-"));

    navigator.geolocation.getCurrentPosition(function(position) {
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({
            "location": new google.maps.LatLng(position.coords.latitude, position.coords.longitude)
          },
          function(results, status) {
            if (status == google.maps.GeocoderStatus.OK)
              $("#" + addressId).val(results[0].formatted_address);
            else
              $("#error").append("Unable to retrieve your address<br />");
          });
      },


      function(positionError) {
        $("#error").append("Error: " + positionError.message + "<br />");
      }, {
        enableHighAccuracy: true,
        timeout: 10 * 1000 // 10 seconds
      });
  });

  $("#calculate-route").submit(function(event) {
    event.preventDefault();
    calculateRoute($("#from").val(), $("#to").val());
  });
});
var icons = new Array();
icons["red"] = {
  url: "http://maps.google.com/mapfiles/ms/micons/red.png",
  // This marker is 32 pixels wide by 32 pixels tall.
  size: new google.maps.Size(32, 32),
  // The origin for this image is 0,0.
  origin: new google.maps.Point(0, 0),
  // The anchor for this image is at 9,34.
  anchor: new google.maps.Point(16, 32),
  labelOrigin: new google.maps.Point(16, 10)
};

function getMarkerImage(iconColor) {
  if ((typeof(iconColor) == "undefined") || (iconColor == null)) {
    iconColor = "red";
  }
  if (!icons[iconColor]) {
    icons[iconColor] = {
      url: "http://maps.google.com/mapfiles/ms/micons/" + iconColor + ".png",
      // This marker is 32 pixels wide by 32 pixels tall.
      size: new google.maps.Size(32, 32),
      // The origin for this image is 0,0.
      origin: new google.maps.Point(0, 0),
      // The anchor for this image is at 6,20.
      anchor: new google.maps.Point(16, 32),
      labelOrigin: new google.maps.Point(16, 10)
    };
  }
  return icons[iconColor];

}
// Marker sizes are expressed as a Size of X,Y
// where the origin of the image (0,0) is located
// in the top left of the image.

// Origins, anchor positions and coordinates of the marker
// increase in the X direction to the right and in
// the Y direction down.

var iconImage = {
  url: 'http://maps.google.com/mapfiles/ms/micons/red.png',
  // This marker is 20 pixels wide by 34 pixels tall.
  size: new google.maps.Size(20, 34),
  // The origin for this image is 0,0.
  origin: new google.maps.Point(0, 0),
  // The anchor for this image is at 9,34.
  anchor: new google.maps.Point(9, 34)
};
// Shapes define the clickable region of the icon.
// The type defines an HTML &lt;area&gt; element 'poly' which
// traces out a polygon as a series of X,Y points. The final
// coordinate closes the poly by connecting to the first
// coordinate.
var iconShape = {
  coord: [9, 0, 6, 1, 4, 2, 2, 4, 0, 8, 0, 12, 1, 14, 2, 16, 5, 19, 7, 23, 8, 26, 9, 30, 9, 34, 11, 34, 11, 30, 12, 26, 13, 24, 14, 21, 16, 18, 18, 16, 20, 12, 20, 8, 18, 4, 16, 2, 15, 1, 13, 0],
  type: 'poly'
};
var infowindow = new google.maps.InfoWindow({
  size: new google.maps.Size(150, 50)
});

function createMarker(latlng, title, html, color, label, map) {
  var contentString = html ;
  var marker = new google.maps.Marker({
    position: latlng,
    draggable: true,
    map: map,
    icon: getMarkerImage(color),
    shape: iconShape,
    title: title,
    label: label,
    zIndex: Math.round(latlng.lat() * -100000) << 5
  });
  marker.myname = title;
  // gmarkers.push(marker);

  google.maps.event.addListener(marker, 'click', function() {
    infowindow.setContent(contentString);
    infowindow.open(map, marker);
  });

  return marker;
}
</script>

</html>
